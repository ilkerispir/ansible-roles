---
- name: Print the gateway for each host when defined
  ansible.builtin.debug:
    msg: System {{ inventory_hostname }} has gateway {{ ansible_default_ipv4.gateway }}
  when: ansible_default_ipv4.gateway is defined

- name: Add an NGINX Apt signing key
  ansible.builtin.apt_key:
    url: https://nginx.org/keys/nginx_signing.key
    state: present

- name: Add nginx stable repository from PPA and install its signing key on Ubuntu target
  ansible.builtin.apt_repository:
    repo: deb http://nginx.org/packages/ubuntu {{ ansible_distribution_release }} nginx

- name: NGINX installion
  apt:
    name: nginx={{ nginx_stable_version }}
    state: present
    update_cache: yes

- name: Start service NGINX, if not started
  ansible.builtin.service:
    name: nginx
    state: started

- name: Template a file to /etc/nginx/conf.d/{{ appname }}.conf
  ansible.builtin.template:
    src: vhost.conf.j2
    dest: /etc/nginx/conf.d/{{ appname }}.conf

- name: Restart NGINX service
  ansible.builtin.service:
    name: nginx
    state: restarted
